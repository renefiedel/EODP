#########################################################################################
#
# Project    : ExpCFI
# Copyright  : DEIMOS Space S.L.
#
# Module     : make.LINUX64_LEGACY
# Purpose    : It is the makefile of the validation test
#
# History:     +--------------------------------------------------------------------------------+
#              | Version |  Date  |       Name        | Change                                  |
#              |--------------------------------------------------------------------------------|
#              |    1.0  |15/04/02| DEIMOS Space S.L. | First version from                      |
#              |         |        |                   | Envisat CFI                             |
#              +--------------------------------------------------------------------------------+
#              |    2.0  |29/11/02| DEIMOS Space S.L. | Maintenance release                     |
#              |         |        |                   | New header functions                    |
#              +--------------------------------------------------------------------------------+
#              |    2.1  |13/05/03| DEIMOS Space S.L. | Maintenance release                     |
#              |         |        |                   | MAC OS Version                          |
#              |         |        |	                  | New functions added:                    |
#              |         |        |                   |  + function to write a complete FH      |
#              |         |        |                   |  + new search function                  |
#              +--------------------------------------------------------------------------------+
#              |    2.2  |30/09/03| DEIMOS Space S.L. | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    3.0  |21/07/04| DEIMOS Space S.L. | New interfaces                          |
#              +--------------------------------------------------------------------------------+
#              |    3.1  |13/10/04| DEIMOS, S.L.      | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    3.2  |15/11/04| DEIMOS Space S.L. | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    3.3  |11/07/05| DEIMOS Space S.L. | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    3.4  |18/11/05| DEIMOS Space S.L. | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    3.5  |26/05/06| DEIMOS Space S.L. | New features:                           |
#              |         |        |                   |  + Thread safe library                  |
#              |         |        |                   |  + C99 compliant                        |
#              |         |        |                   |  + Optimized libray                     |
#              |         |        |                   |  + 64-Bits library for MACOS,           |
#              |         |        |                   |  + LINUX32_LEGACY and SOLARIS           |
#              +--------------------------------------------------------------------------------+
#              |    3.6  |24/11/06| DEIMOS Space S.L. | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    3.7  |13/07/07| DEIMOS Space S.L. | Maintenance release                     |
#              |         |        |                   | New features:                           |
#              |         |        |                   |  + expcfi_check_libs                    |
#              |         |        |                   |  + library version for Mac OS X         |
#              |         |        |                   |    on Intel (32 and 64 bits)            |
#              +--------------------------------------------------------------------------------+
#              |  3.7.2  |31/07/08| DEIMOS S.L.       | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    4.0  |19/01/09| DEIMOS Space S.L. | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    4.1  |07/05/10| DEIMOS Space S.L. | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    4.2  |31/01/11| DEIMOS Space S.L.U| Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    4.3  |06/02/12| DEIMOS Space S.L.U| Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    4.4  |05/07/12| DEIMOS S.L.U      | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    4.5  |01/03/13| DEIMOS S.L.U      | Maintenance release                     |
#              |         |        |                   | New features:                           |
#              |         |        |                   |  + Longitude of XML fields not          |
#              |         |        |                   |    limited to 512 characters.           |
#              +--------------------------------------------------------------------------------+
#              |    4.6  |03/10/13| DEIMOS S.L.U      | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    4.7  |28/03/14| DEIMOS S.L.U      | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    4.8  |29/10/14| DEIMOS S.L.U      | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |    4.9  |23/04/15| DEIMOS S.L.U      | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |  4.9.1  |05/06/15| DEIMOS S.L.U      | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |  4.10   |29/10/15| DEIMOS S.L.U      | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |  4.11   |15/04/16| DEIMOS S.L.U      | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |   4.12  |03/11/16| DEIMOS S.L.U      | Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |   4.13  |05/04/17| DEIMOS Space S.L.U| Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |   4.14  |16/11/17| DEIMOS Space S.L.U| Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |   4.15  |20/04/18| DEIMOS Space S.L.U| Maintenance release                     |
#              |         |        |                   | New features:                           |
#              |         |        |                   |  + Refactored code                      |
#              +--------------------------------------------------------------------------------+
#              |   4.16  |09/11/18| DEIMOS Space S.L.U| Maintenance release                     |
#              +--------------------------------------------------------------------------------+
#              |   4.17  |10/05/19| DEIMOS Space S.L.U| Maintenance release                     |
#              +--------------------------------------------------------------------------------+
# 
#########################################################################################

# set OS to your operating system (SOLARIS, WINDOWS, LINUX64_LEGACY, MACOS)

OS		= LINUX64

# C standard

STD = -std=c99

# set CC to your compiler (gcc)

CC		= gcc $(STD)

# optionally select dynamic linking CFI libraries

# DYN		= _so
  DYN		=

#
#  End of Customization Area
#
#########################################################################################

CFI		= explorer_file_handling

#------------------------------------------------------------------------------
#       Set silent mode
#------------------------------------------------------------------------------

.SILENT :

#------------------------------------------------------------------------------
#       Bash shell
#------------------------------------------------------------------------------

SHELL = /bin/bash

#------------------------------------------------------------------------------
#	Compiler flags
#	--------------
#
#	 I	  = header files directories
#	 D$(OS)	  = conditional code for SOLARIS/AIX
#
#------------------------------------------------------------------------------

CFLAGS = \
        -m64 \
	-I../../include \
	-D$(OS) \
        -DXF_EARTH_EXPLORER_HEADER

#------------------------------------------------------------------------------
#       Linker tool, flags and libraries 
#------------------------------------------------------------------------------

LIBS_DIR = \
	-L../../lib/$(OS)

LIBS = 	\
	-l$(CFI)$(DYN) \
	-lxml2 -lm -lc -lpthread

#------------------------------------------------------------------------------
#	Makefile default target
#------------------------------------------------------------------------------

default : $(CFI) run

$(CFI):
	echo "---------------------------------"
	echo "$(CFI): ... compiling " $(CFI)_valid.c
	echo "---------------------------------"
	$(CC) $(CFLAGS) $(CFI)_valid.c -o $(CFI)_valid $(LIBS_DIR) $(LIBS) 

run :
	echo "---------------------------------"
	echo "$(CFI): ... running " $(CFI)_valid
	echo "---------------------------------"
	\rm -f $(CFI)_valid.$(OS).out
	./$(CFI)_valid > $(CFI)_valid.$(OS).out 2> $(CFI)_valid.$(OS).err
	echo "---------------------------------"
	echo "$(CFI): ... verifying " $(CFI)_valid.$(OS).out
	echo "---------------------------------"
	echo " "
	if [ `grep "FAIL" $(CFI)_valid.$(OS).out | wc -l` = 0 ] ; then \
	  echo "... $(CFI) LIBRARY INSTALLATION = OK" ; \
	  else echo "... $(CFI) LIBRARY INSTALLATION = FAILED !!" ; fi
	echo " "

clean: 
	\rm -f *.o *.out core *%
